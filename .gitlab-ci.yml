before_script:
  - apt-get update -qq && apt-get install -y -qq python-pip python3-pip pypy tox
  - 'which ssh-agent || ( apt-get install openssh-client -y )'
  - eval $(ssh-agent -s)
  - echo "$MIRROR_SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add - > /dev/null
  - mkdir -p ~/.ssh
  - chmod 700 ~/.ssh
  - git config --global user.email "congma@obspm.fr"
  - git config --global user.name "Cong Ma"
  - git config --global github.user "congma"

stages:
  - test
  - mirror

job_test:
  stage: test
  script:
    - tox
  tags:
    - shared

job_mirror:
  stage: mirror
  script:
    - git remote add --mirror=push github git@github.com:congma/takeevery.git
    - git push github --all
  tags:
    - shared
